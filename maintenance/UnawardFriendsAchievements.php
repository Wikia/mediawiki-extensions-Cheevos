<?php
/**
 * Cheevos
 * Unaward Friends Achievements
 *
 * @author		Wiki Platform Team
 * @copyright	(c) 2017 Curse Inc.
 * @license		All Rights Reserved
 * @package		Cheevos
 * @link		http://www.curse.com/
 *
 **/

require_once(dirname(dirname(dirname(__DIR__)))."/maintenance/Maintenance.php");

class UnawardFriendsAchievements extends Maintenance {
	/**
	 * Constructor
	 *
	 * @access	public
	 * @return	void
	 */
	public function __construct() {
		parent::__construct();

		$this->mDescription = "Removes all points for awarded Friends achievements.";
	}

	/**
	 * Processes achievements that may need to be awarded to people.
	 *
	 * @access	public
	 * @return	void
	 */
	public function execute() {
		global $wgMetaNamespace, $dsSiteKey;

		$this->DB = wfGetDB(DB_MASTER);

		$curseIds = [
				'11961936'	=> 52,
				'9101665'	=> 49,
				'12308384'	=> 34,
				'4126368'	=> 21,
				'9480300'	=> 21,
				'17793261'	=> 19,
				'8880607'	=> 15,
				'16208336'	=> 15,
				'1596830'	=> 15,
				'12124114'	=> 14,
				'12239524'	=> 14,
				'8594664'	=> 13,
				'21016847'	=> 12,
				'206798'	=> 11,
				'12416365'	=> 11,
				'12280256'	=> 11,
				'17195002'	=> 10,
				'6514759'	=> 10,
				'11560972'	=> 9,
				'10628053'	=> 9,
				'12365369'	=> 9,
				'12645296'	=> 9,
				'9269247'	=> 9,
				'9566363'	=> 8,
				'8201843'	=> 8,
				'12234766'	=> 8,
				'19474562'	=> 8,
				'10659072'	=> 8,
				'11255540'	=> 8,
				'6853259'	=> 8,
				'17368642'	=> 8,
				'8847925'	=> 8,
				'15435440'	=> 8,
				'15525911'	=> 8,
				'11069207'	=> 8,
				'6992759'	=> 8,
				'12781458'	=> 7,
				'14888264'	=> 7,
				'16114361'	=> 7,
				'7437321'	=> 7,
				'12280240'	=> 7,
				'12281173'	=> 7,
				'4377929'	=> 7,
				'12195048'	=> 7,
				'15903891'	=> 6,
				'10993621'	=> 6,
				'17698700'	=> 6,
				'13762795'	=> 6,
				'12004342'	=> 6,
				'7290721'	=> 6,
				'12251641'	=> 6,
				'9363760'	=> 6,
				'2753098'	=> 6,
				'12241572'	=> 6,
				'16366467'	=> 6,
				'6887316'	=> 6,
				'12051504'	=> 5,
				'21138817'	=> 5,
				'12003432'	=> 5,
				'12052615'	=> 5,
				'12107285'	=> 5,
				'14820191'	=> 5,
				'11975440'	=> 5,
				'6990491'	=> 5,
				'17049632'	=> 5,
				'12000836'	=> 5,
				'10690379'	=> 5,
				'15429015'	=> 5,
				'929650'	=> 5,
				'12239742'	=> 5,
				'17109816'	=> 5,
				'20578943'	=> 4,
				'19527367'	=> 4,
				'14483758'	=> 4,
				'9047105'	=> 4,
				'15449770'	=> 4,
				'12362403'	=> 4,
				'7999700'	=> 4,
				'21183052'	=> 4,
				'18276154'	=> 4,
				'12005936'	=> 4,
				'21697474'	=> 4,
				'17305204'	=> 4,
				'15933414'	=> 4,
				'9435360'	=> 4,
				'17093644'	=> 4,
				'6510976'	=> 4,
				'12637806'	=> 4,
				'11974245'	=> 4,
				'12006183'	=> 4,
				'12246663'	=> 4,
				'15499786'	=> 4,
				'7717008'	=> 4,
				'5951844'	=> 4,
				'13559209'	=> 4,
				'17248746'	=> 4,
				'11983957'	=> 3,
				'11084660'	=> 3,
				'20909811'	=> 3,
				'13599068'	=> 3,
				'769206'	=> 3,
				'20691439'	=> 3,
				'11736312'	=> 3,
				'16540445'	=> 3,
				'17126341'	=> 3,
				'10920527'	=> 3,
				'17052234'	=> 3,
				'15474495'	=> 3,
				'17723740'	=> 3,
				'13126469'	=> 3,
				'16549163'	=> 3,
				'18897340'	=> 3,
				'7776540'	=> 3,
				'31736'		=> 3,
				'19312645'	=> 3,
				'19553118'	=> 3,
				'12535479'	=> 3,
				'7935234'	=> 3,
				'11741664'	=> 3,
				'10659094'	=> 3,
				'12907364'	=> 3,
				'7791643'	=> 3,
				'18991092'	=> 3,
				'15497041'	=> 3,
				'8380918'	=> 3,
				'12016833'	=> 3,
				'12528650'	=> 3,
				'17212600'	=> 3,
				'11084800'	=> 3,
				'15564639'	=> 3,
				'12298691'	=> 3,
				'19756187'	=> 3,
				'19322664'	=> 3,
				'17127014'	=> 3,
				'11976540'	=> 3,
				'12971211'	=> 3,
				'15757888'	=> 3,
				'17886700'	=> 3,
				'20294191'	=> 3,
				'13507687'	=> 3,
				'19750184'	=> 3,
				'17730874'	=> 2,
				'10565179'	=> 2,
				'16395778'	=> 2,
				'17963597'	=> 2,
				'8555714'	=> 2,
				'13770445'	=> 2,
				'19310926'	=> 2,
				'21764294'	=> 2,
				'87049'		=> 2,
				'21414712'	=> 2,
				'17988008'	=> 2,
				'21694242'	=> 2,
				'19193439'	=> 2,
				'12317869'	=> 2,
				'10036554'	=> 2,
				'12955513'	=> 2,
				'2584956'	=> 2,
				'11914795'	=> 2,
				'7285393'	=> 2,
				'4668910'	=> 2,
				'17611055'	=> 2,
				'7234853'	=> 2,
				'12280416'	=> 2,
				'12637218'	=> 2,
				'14704699'	=> 2,
				'11686567'	=> 2,
				'17101444'	=> 2,
				'21075637'	=> 2,
				'13771696'	=> 2,
				'18463618'	=> 2,
				'15697020'	=> 2,
				'17906002'	=> 2,
				'12253890'	=> 2,
				'12225292'	=> 2,
				'7565526'	=> 2,
				'2101003'	=> 2,
				'20947139'	=> 2,
				'13782895'	=> 2,
				'14079542'	=> 2,
				'17830066'	=> 2,
				'17313028'	=> 2,
				'14473761'	=> 2,
				'1711908'	=> 2,
				'12152820'	=> 2,
				'14213040'	=> 2,
				'8049729'	=> 2,
				'10034849'	=> 2,
				'17181487'	=> 2,
				'18989823'	=> 2,
				'20875790'	=> 2,
				'17112486'	=> 2,
				'21073815'	=> 2,
				'9728280'	=> 2,
				'16742012'	=> 2,
				'18883873'	=> 2,
				'9868797'	=> 2,
				'1177'		=> 2,
				'19279352'	=> 2,
				'10989135'	=> 2,
				'10566800'	=> 2,
				'19466773'	=> 2,
				'19285625'	=> 2,
				'17180227'	=> 2,
				'17140508'	=> 2,
				'12262178'	=> 2,
				'20734482'	=> 2,
				'13652164'	=> 2,
				'15127195'	=> 2,
				'9514936'	=> 2,
				'8110817'	=> 2,
				'15541130'	=> 2,
				'887588'	=> 2,
				'21027591'	=> 2,
				'20717861'	=> 2,
				'11977147'	=> 2,
				'11662925'	=> 2,
				'17121407'	=> 2,
				'21010305'	=> 2,
				'11971739'	=> 2,
				'16189316'	=> 2,
				'2289507'	=> 2,
				'12632213'	=> 2,
				'8595146'	=> 2,
				'21106535'	=> 1,
				'13593374'	=> 1,
				'20448849'	=> 1,
				'21121049'	=> 1,
				'17140545'	=> 1,
				'16819064'	=> 1,
				'26333'		=> 1,
				'13030280'	=> 1,
				'12492789'	=> 1,
				'18795010'	=> 1,
				'16181719'	=> 1,
				'2488129'	=> 1,
				'7377494'	=> 1,
				'8862944'	=> 1,
				'12951962'	=> 1,
				'20608383'	=> 1,
				'16192673'	=> 1,
				'3245906'	=> 1,
				'20545471'	=> 1,
				'19347997'	=> 1,
				'20611382'	=> 1,
				'17725569'	=> 1,
				'13958865'	=> 1,
				'17174321'	=> 1,
				'19621736'	=> 1,
				'18170695'	=> 1,
				'18789162'	=> 1,
				'9531006'	=> 1,
				'17937937'	=> 1,
				'11022957'	=> 1,
				'13991044'	=> 1,
				'12216485'	=> 1,
				'12279807'	=> 1,
				'6915041'	=> 1,
				'14103833'	=> 1,
				'20426492'	=> 1,
				'6888704'	=> 1,
				'18777508'	=> 1,
				'16706210'	=> 1,
				'13055330'	=> 1,
				'20595602'	=> 1,
				'16419045'	=> 1,
				'20620296'	=> 1,
				'17072498'	=> 1,
				'20167217'	=> 1,
				'21534471'	=> 1,
				'19081271'	=> 1,
				'17721048'	=> 1,
				'16636417'	=> 1,
				'12725444'	=> 1,
				'12779131'	=> 1,
				'16727808'	=> 1,
				'18660468'	=> 1,
				'9217513'	=> 1,
				'9872833'	=> 1,
				'10138177'	=> 1,
				'20561189'	=> 1,
				'12767980'	=> 1,
				'15979432'	=> 1,
				'15980789'	=> 1,
				'21183090'	=> 1,
				'11266169'	=> 1,
				'17800202'	=> 1,
				'10581610'	=> 1,
				'17814660'	=> 1,
				'20451579'	=> 1,
				'16021640'	=> 1,
				'20560799'	=> 1,
				'16843154'	=> 1,
				'19576745'	=> 1,
				'19660557'	=> 1,
				'18649005'	=> 1,
				'19210301'	=> 1,
				'18873035'	=> 1,
				'1797455'	=> 1,
				'13986222'	=> 1,
				'18895137'	=> 1,
				'16848382'	=> 1,
				'21749335'	=> 1,
				'12358729'	=> 1,
				'15007742'	=> 1,
				'11775455'	=> 1,
				'14962434'	=> 1,
				'9678972'	=> 1,
				'11714525'	=> 1,
				'9150831'	=> 1,
				'19151711'	=> 1,
				'15822020'	=> 1,
				'20897531'	=> 1,
				'20758985'	=> 1,
				'15770911'	=> 1,
				'16085676'	=> 1,
				'13889014'	=> 1,
				'13339786'	=> 1,
				'19053187'	=> 1,
				'17813021'	=> 1,
				'19187469'	=> 1,
				'8947057'	=> 1,
				'6797643'	=> 1,
				'18010511'	=> 1,
				'19218157'	=> 1,
				'20260096'	=> 1,
				'21264955'	=> 1,
				'20785257'	=> 1,
				'19948008'	=> 1,
				'21219359'	=> 1,
				'8414975'	=> 1,
				'21548102'	=> 1,
				'10351439'	=> 1,
				'16105469'	=> 1,
				'8272283'	=> 1,
				'8658619'	=> 1,
				'21769014'	=> 1,
				'11585110'	=> 1,
				'12048508'	=> 1,
				'17400955'	=> 1,
				'16461209'	=> 1,
				'18154538'	=> 1,
				'15658430'	=> 1,
				'9722092'	=> 1,
				'16844791'	=> 1,
				'12990154'	=> 1,
				'6397637'	=> 1,
				'12890234'	=> 1,
				'19393183'	=> 1,
				'15256974'	=> 1,
				'16160484'	=> 1,
				'19486959'	=> 1,
				'7964541'	=> 1,
				'16840970'	=> 1,
				'716555'	=> 1,
				'10427787'	=> 1,
				'19846222'	=> 1,
				'16465103'	=> 1,
				'11129705'	=> 1,
				'18817123'	=> 1,
				'12140609'	=> 1,
				'18565626'	=> 1,
				'19380153'	=> 1,
				'19605857'	=> 1,
				'6714896'	=> 1,
				'18230777'	=> 1,
				'21532195'	=> 1,
				'17338494'	=> 1,
				'19431149'	=> 1,
				'19353262'	=> 1,
				'10033376'	=> 1,
				'12738446'	=> 1,
				'20882849'	=> 1,
				'20987523'	=> 1,
				'17564716'	=> 1,
				'12903830'	=> 1,
				'10568534'	=> 1,
				'20984334'	=> 1,
				'14918270'	=> 1,
				'20911312'	=> 1,
				'10517031'	=> 1,
				'10015975'	=> 1,
				'18499137'	=> 1,
				'1052757'	=> 1,
				'18746787'	=> 1,
				'9629293'	=> 1,
				'13098735'	=> 1,
				'18211811'	=> 1,
				'11910665'	=> 1,
				'20448834'	=> 1,
				'64179'		=> 1,
				'19330404'	=> 1,
				'11786226'	=> 1,
				'15912881'	=> 1,
				'16833043'	=> 1,
				'14677530'	=> 1,
				'18096266'	=> 1,
				'14582269'	=> 1,
				'14980620'	=> 1,
				'6945354'	=> 1,
				'16269378'	=> 1,
				'6831561'	=> 1,
				'15105671'	=> 1,
				'17754506'	=> 1,
				'20213401'	=> 1,
				'17964995'	=> 1,
				'12053453'	=> 1,
				'15603641'	=> 1,
				'13948096'	=> 1,
				'16985441'	=> 1,
				'14674042'	=> 1,
				'18247307'	=> 1,
				'12280637'	=> 1,
				'13037369'	=> 1,
				'16987271'	=> 1,
				'9698000'	=> 1,
				'21646092'	=> 1,
				'20993052'	=> 1,
				'11232973'	=> 1,
				'15235808'	=> 1,
				'10250397'	=> 1,
				'17887261'	=> 1,
				'17872979'	=> 1,
				'17368282'	=> 1,
				'11190365'	=> 1,
				'15853516'	=> 1,
				'18096352'	=> 1,
				'14160036'	=> 1,
				'18826697'	=> 1,
				'21347486'	=> 1,
				'7822976'	=> 1,
				'20738017'	=> 1,
				'20871758'	=> 1,
				'18904911'	=> 1,
				'17285950'	=> 1,
				'16182930'	=> 1,
				'18337043'	=> 1,
				'17065724'	=> 1,
				'5800'		=> 1,
				'16768734'	=> 1,
				'278540'	=> 1,
				'10666866'	=> 1,
				'20944486'	=> 1,
				'16770286'	=> 1,
				'17156322'	=> 1,
				'14803256'	=> 1,
				'11053391'	=> 1,
				'12751635'	=> 1,
				'17511073'	=> 1,
				'16925680'	=> 1,
				'14094220'	=> 1,
				'13639124'	=> 1,
				'14865069'	=> 1,
				'21610561'	=> 1,
				'13559635'	=> 1,
				'16975510'	=> 1,
				'11017984'	=> 1,
				'10966569'	=> 1,
				'16968051'	=> 1,
				'12286662'	=> 1,
				'12437438'	=> 1,
				'13900803'	=> 1,
				'19047872'	=> 1,
				'19187011'	=> 1,
				'21224121'	=> 1,
				'3891104'	=> 1,
				'19557713'	=> 1,
				'20294122'	=> 1,
				'2634558'	=> 1,
				'19300717'	=> 1,
				'20713437'	=> 1,
				'17300186'	=> 1,
				'17174813'	=> 1,
				'16071624'	=> 1,
				'11202400'	=> 1,
				'15366976'	=> 1,
				'9954857'	=> 1,
				'12218749'	=> 1,
				'16736540'	=> 1,
				'16664848'	=> 1,
				'20984191'	=> 1,
				'9172180'	=> 1,
				'17322386'	=> 1,
				'11251534'	=> 1,
				'16823779'	=> 1,
				'19391320'	=> 1,
				'12627139'	=> 1,
				'6072766'	=> 1,
				'17614856'	=> 1,
				'20308872'	=> 1,
				'16145364'	=> 1,
				'15712298'	=> 1,
				'15572293'	=> 1,
				'17011458'	=> 1,
				'8938608'	=> 1,
				'21058739'	=> 1,
				'10827226'	=> 1,
				'13085500'	=> 1,
				'20816365'	=> 1,
				'17791926'	=> 1,
				'7461027'	=> 1,
				'14007514'	=> 1,
				'11917255'	=> 1,
				'4400787'	=> 1,
				'12815402'	=> 1,
				'14354052'	=> 1,
				'12737004'	=> 1,
				'18813443'	=> 1,
				'14049509'	=> 1,
				'14415335'	=> 1,
				'1318113'	=> 1,
				'18887616'	=> 1,
				'19743998'	=> 1,
				'12177229'	=> 1,
				'12234964'	=> 1,
				'10985596'	=> 1,
				'18025845'	=> 1,
				'11070348'	=> 1,
				'11941986'	=> 1,
				'18847031'	=> 1,
				'16053714'	=> 1,
				'19751306'	=> 1,
				'21702989'	=> 1,
				'13869832'	=> 1,
				'16771390'	=> 1,
				'12207109'	=> 1,
				'21155717'	=> 1,
				'18251906'	=> 1,
				'13669510'	=> 1,
				'19282593'	=> 1,
				'11888268'	=> 1,
				'20169251'	=> 1,
				'10251093'	=> 1,
				'20799752'	=> 1,
				'8961487'	=> 1,
				'7402110'	=> 1,
				'17543521'	=> 1,
				'18947087'	=> 1,
				'6812476'	=> 1,
				'11619426'	=> 1,
				'19645339'	=> 1,
				'12115485'	=> 1,
				'16810408'	=> 1,
				'7288646'	=> 1,
				'18496631'	=> 1,
				'7915744'	=> 1,
				'15126720'	=> 1,
				'17437743'	=> 1,
				'16787738'	=> 1,
				'15820918'	=> 1,
				'17116548'	=> 1,
				'15529962'	=> 1,
				'21530712'	=> 1,
				'497643'	=> 1,
				'17894449'	=> 1,
				'17624191'	=> 1,
				'17033215'	=> 1,
				'19487012'	=> 1,
				'12085290'	=> 1,
				'16380954'	=> 1,
				'7828037'	=> 1,
				'17353549'	=> 1,
				'16153657'	=> 1,
				'7914337'	=> 1,
				'17133021'	=> 1,
				'2043322'	=> 1,
				'17153863'	=> 1,
				'8815987'	=> 1,
				'18929365'	=> 1,
				'16834272'	=> 1,
				'21442143'	=> 1,
				'17495916'	=> 1,
				'20356534'	=> 1,
				'16156982'	=> 1,
				'20772256'	=> 1,
				'15680791'	=> 1,
				'12115089'	=> 1,
				'18844242'	=> 1,
				'5911753'	=> 1,
				'8066591'	=> 1,
				'10743744'	=> 1,
				'14070883'	=> 1,
				'15089898'	=> 1,
				'11970817'	=> 1,
				'6755209'	=> 1,
				'21672256'	=> 1,
				'7393536'	=> 1,
				'6839504'	=> 1,
				'17000214'	=> 1,
				'11006859'	=> 1,
				'15806847'	=> 1,
				'16893652'	=> 1,
				'16525194'	=> 1
		];

		$result = $this->DB->select(
			['user'],
			['*'],
			[
				'curse_id'	=> array_keys($curseIds)
			],
			__METHOD__
		);

		foreach ($result as $user) {
			$user = User::newFromRow($user);
			$lookup = CentralIdLookup::factory();
			$globalId = $lookup->centralIdFromLocalUser($user, CentralIdLookup::AUDIENCE_RAW);
			if ($user !== false && $user->getId()) {
				if (array_key_exists($globalId, $globalIds)) {
					$friends = $globalIds[$globalId];
					if ($friends >= 10) {
						$points = -30;
					} else {
						$points = -10;
					}
					$this->output("\nRemoving {$points} points for ".$user->getName()."\n");
					$points = EditPoints::achievementRevoked($user->getId(), $points);
					if ($points->save()) {
						$points->updatePointTotals();
					}
				}
			}
		}
	}
}

$maintClass = 'UnawardFriendsAchievements';
require_once(RUN_MAINTENANCE_IF_MAIN);
